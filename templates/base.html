<!DOCTYPE html>
<html lang="de">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="{% block meta_description %}Ingenieurbüro Behringer & Partner - Ihr Experte für Tiefbau, Wasserwirtschaft und Straßenbau seit 1968.{% endblock %}">
    <title>{% block title %}Behringer & Partner{% endblock %}</title>

    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
    <link rel="shortcut icon" href="{{ url_for('static', filename='favicon/favicon.ico') }}">

    <link rel="icon" type="image/png" sizes="32x32" href="{{ url_for('static', filename='favicon/favicon-32x32.png') }}">
    <link rel="icon" type="image/png" sizes="16x16" href="{{ url_for('static', filename='favicon/favicon-16x16.png') }}">

    <link rel="apple-touch-icon" sizes="180x180" href="{{ url_for('static', filename='favicon/apple-touch-icon.png') }}">

    <link rel="manifest" href="{{ url_for('static', filename='favicon/site.webmanifest') }}">

    <link rel="mask-icon" href="{{ url_for('static', filename='favicon/safari-pinned-tab.svg') }}" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="theme-color" content="#ffffff">

    <meta property="og:title" content="{% block og_title %}Behringer & Partner mbB{% endblock %}">
    <meta property="og:description" content="{% block og_description %}Ihr Partner im Tiefbau seit 1968.{% endblock %}">
    <meta property="og:image" content="{{ url_for('static', filename='images/layout/logo.png', _external=True) }}">
    <meta property="og:url" content="{{ request.url }}">
    <meta property="og:type" content="website">
</head>

<body>
    {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
    <div class="flash-messages-container">
        {% for category, message in messages %}
        <div class="alert alert-{{ category }}">
            {{ message }}
            <span class="close-flash" onclick="this.parentElement.style.display='none';">&times;</span>
        </div>
        {% endfor %}
    </div>
    {% endif %}
    {% endwith %}
    <header class="site-header">
        <div class="container header-inner">
            <a href="{{ url_for('index') }}" class="logo">
                <img src='{{ url_for("static", filename="images/layout/logo.png") }}' alt="Behringer & Partner Logo"
                    loading="lazy">
            </a>

            <nav class="main-nav">
                {% if back_url and back_text %}

                <ul class="nav-list">
                    <li>
                        <a href="{{ back_url }}" class="btn btn-secondary btn-sm">❮ Zurück zu {{ back_text }}</a>
                    </li>
                    <li><a href="{{ url_for('index') }}#contact" class="btn btn-primary btn-sm">Kontakt</a></li>
                </ul>

                {% else %}

                <ul class="nav-list">
                    <li><a href="{{ url_for('index') }}#about">Über uns</a></li>
                    <li><a href="{{ url_for('news') }}">Neuigkeiten</a></li>
                    <li class="nav-item dropdown">
                        <a href="{{ url_for('index') }}#services" aria-haspopup="true" aria-expanded="false">
                            <span>Leistungen <span class="dropdown-arrow">▼</span></span></a>
                        <ul class="dropdown-menu">
                            <li><a href="{{ url_for('siedlungswasserwirtschaft') }}">Siedlungswasserwirtschaft</a></li>
                            <li><a href="{{ url_for('strassenbau_brueckenbau') }}">Straßenbau & Brückenbau</a></li>
                            <li><a href="{{ url_for('fernwaerme') }}">Fernwärme</a></li>
                            <li><a href="{{ url_for('hydraulische_nachweise') }}">Hydraulische Nachweise</a></li>
                            <li><a href="{{ url_for('baulanderschliessung') }}">Baulanderschließung</a></li>
                            <li><a href="{{ url_for('kommunales_gis') }}">Kommunales GIS</a></li>
                            <li><a href="{{ url_for('sanierungen') }}">Sanierungen</a></li>
                            <li><a href="{{ url_for('wasserbau') }}">Wasserbau</a></li>
                        </ul>
                    </li>
                    <li class="nav-item dropdown">
                        <a href="{{ url_for('index') }}#company" aria-haspopup="true" aria-expanded="false">
                            <span>Unternehmen <span class="dropdown-arrow">▼</span></span></a>
                        <ul class="dropdown-menu">
                            <li><a href="{{ url_for('unternehmen_team') }}">Team</a></li>
                            <li><a href="{{ url_for('firmengeschichte') }}">Firmengeschichte</a></li>
                            <li><a href="{{ url_for('standorte') }}">Standorte</a></li>
                            <li><a href="{{ url_for('unternehmen_netzwerk') }}">Netzwerk</a></li>
                            <li><a href="{{ url_for('unternehmen_stellenangebote') }}">Stellenangebote</a></li>
                        </ul>
                    </li>
                    <li><a href="{{ url_for('index') }}#contact" class="btn btn-primary">Kontakt</a></li>
                </ul>

                {% endif %}
            </nav>
            <button class="nav-toggle" aria-label="Menü öffnen" aria-expanded="false">☰</button>
        </div>
    </header>

    {% block content %}{% endblock %}

    <footer class="site-footer">
        <div class="container footer-grid">
            <div>
                <h4>Navigation</h4>
                <ul>
                    <li><a href="{{ url_for('index') }}#about">Über uns</a></li>
                    <li><a href="{{ url_for('news') }}">Neuigkeiten</a></li>
                    <li><a href="{{ url_for('index') }}#services">Leistungen</a></li>
                    <li><a href="{{ url_for('index') }}#company">Unternehmen</a></li>
                    <li><a href="{{ url_for('index') }}#contact">Kontakt</a></li>
                </ul>
            </div>
            <div>
                <h4>Leistungen</h4>
                <ul>
                    <li><a href="{{ url_for('siedlungswasserwirtschaft') }}">Siedlungswasserwirtschaft</a></li>
                    <li><a href="{{ url_for('strassenbau_brueckenbau') }}">Straßenbau & Brückenbau</a></li>
                    <li><a href="{{ url_for('fernwaerme') }}">Fernwärme</a></li>
                    <li><a href="{{ url_for('hydraulische_nachweise') }}">Hydraulische Nachweise</a></li>
                    <li><a href="{{ url_for('baulanderschliessung') }}">Baulanderschließung</a></li>
                    <li><a href="{{ url_for('kommunales_gis') }}">Kommunales GIS</a></li>
                    <li><a href="{{ url_for('sanierungen') }}">Sanierungen</a></li>
                    <li><a href="{{ url_for('wasserbau') }}">Wasserbau</a></li>
                </ul>
            </div>
            <div>
                <h4>Kontakt</h4>
                <address>
                    Behringer & Partner mbB<br>
                    Luitpoldallee 32<br>
                    D-84453 Mühldorf a. Inn<br>
                    <a href="tel:+4986319867900">Tel: +49 8631 98679-00</a><br>
                    <a href="mailto:info@ib-behringer.de">E-Mail: info@ib-behringer.de</a>
                </address>
            </div>
            <div>
                <h4>Rechtliches</h4>
                <ul>
                    <li><a href="{{ url_for('impressum') }}">Impressum</a></li>
                    <li><a href="{{ url_for('impressum') }}#datenschutz">Datenschutz</a></li>
                </ul>
            </div>
            <div>
                <h4>Folgen Sie uns</h4>
                <div class="footer-socials">
                    <a href="https://www.instagram.com/ibb_mue/" target="_blank" rel="noopener"
                        aria-label="Instagram"><svg class="icon-svg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640"><!--!Font Awesome Free v7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2025 Fonticons, Inc.--><path d="M320.3 205C256.8 204.8 205.2 256.2 205 319.7C204.8 383.2 256.2 434.8 319.7 435C383.2 435.2 434.8 383.8 435 320.3C435.2 256.8 383.8 205.2 320.3 205zM319.7 245.4C360.9 245.2 394.4 278.5 394.6 319.7C394.8 360.9 361.5 394.4 320.3 394.6C279.1 394.8 245.6 361.5 245.4 320.3C245.2 279.1 278.5 245.6 319.7 245.4zM413.1 200.3C413.1 185.5 425.1 173.5 439.9 173.5C454.7 173.5 466.7 185.5 466.7 200.3C466.7 215.1 454.7 227.1 439.9 227.1C425.1 227.1 413.1 215.1 413.1 200.3zM542.8 227.5C541.1 191.6 532.9 159.8 506.6 133.6C480.4 107.4 448.6 99.2 412.7 97.4C375.7 95.3 264.8 95.3 227.8 97.4C192 99.1 160.2 107.3 133.9 133.5C107.6 159.7 99.5 191.5 97.7 227.4C95.6 264.4 95.6 375.3 97.7 412.3C99.4 448.2 107.6 480 133.9 506.2C160.2 532.4 191.9 540.6 227.8 542.4C264.8 544.5 375.7 544.5 412.7 542.4C448.6 540.7 480.4 532.5 506.6 506.2C532.8 480 541 448.2 542.8 412.3C544.9 375.3 544.9 264.5 542.8 227.5zM495 452C487.2 471.6 472.1 486.7 452.4 494.6C422.9 506.3 352.9 503.6 320.3 503.6C287.7 503.6 217.6 506.2 188.2 494.6C168.6 486.8 153.5 471.7 145.6 452C133.9 422.5 136.6 352.5 136.6 319.9C136.6 287.3 134 217.2 145.6 187.8C153.4 168.2 168.5 153.1 188.2 145.2C217.7 133.5 287.7 136.2 320.3 136.2C352.9 136.2 423 133.6 452.4 145.2C472 153 487.1 168.1 495 187.8C506.7 217.3 504 287.3 504 319.9C504 352.5 506.7 422.6 495 452z"/></svg></a>
                </div>
                <h4 style="margin-top: 1.5rem;">Wir unterstützen</h4>
                <p style="margin-bottom: var(--space-xs); line-height: 1.4;">
                    <a href="{{ url_for('maedchenschule_chato') }}">Mädchenschule Chato, Tansania</a>
                </p>
                <a href="{{ url_for('maedchenschule_chato') }}">
                    <img src="https://www.ib-behringer.de/wp/wp-content/uploads/2022/12/Suedansicht-2-150x150.jpg"
                        alt="Mädchenschule Chato in Tansania" style="width:80px; border-radius:var(--radius-sm);">
                </a>
            </div>
        </div>
        <div class="footer-bottom">
            <p>© <span id="current-year">2024</span> Ingenieurbüro Behringer & Partner mbB. Alle Rechte vorbehalten.</p>
            <p><a href="{{ url_for('impressum') }}">Impressum</a> | <a
                    href="{{ url_for('impressum') }}#datenschutz">Datenschutz</a></p>
        </div>
    </footer>

    <div id="lightbox" class="lightbox">
        <span class="close-lightbox">×</span>
        <img class="lightbox-content" id="lightbox-image">
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const navToggle = document.querySelector('.nav-toggle');
            const navList = document.querySelector('.main-nav .nav-list');
            const siteHeader = document.querySelector('.site-header');

            // 1. Main Navigation Toggle (Hamburger)
            if (navToggle && navList) {
                navToggle.addEventListener('click', () => {
                    const isOpen = navList.classList.toggle('open');
                    navToggle.setAttribute('aria-expanded', isOpen);
                    navToggle.innerHTML = isOpen ? '×' : '☰';
                    if (!isOpen) {
                        navList.querySelectorAll('.dropdown-menu.submenu-open').forEach(submenu => submenu.classList.remove('submenu-open'));
                        navList.querySelectorAll('.nav-item.dropdown > a.active, .nav-item.dropdown > span.active').forEach(toggle => toggle.classList.remove('active'));
                    }
                });
            }

            // 2. Mobile Dropdown Submenu Toggle
            const dropdownToggles = navList ? navList.querySelectorAll('.nav-item.dropdown > a[aria-haspopup="true"]') : [];

            dropdownToggles.forEach(clickedToggle => {
                clickedToggle.addEventListener('click', function (event) {
                    event.preventDefault(); // Verhindert immer den Sprung zum Anker

                    const submenu = this.parentElement.querySelector('.dropdown-menu');
                    if (!submenu) return;

                    // Prüfen, ob das geklickte Menü bereits offen war
                    const wasOpen = submenu.classList.contains('submenu-open');

                    // Zuerst alle anderen Menüs schließen
                    dropdownToggles.forEach(toggle => {
                        if (toggle !== this) { // Schliesse nicht das gerade geklickte
                            toggle.classList.remove('active');
                            toggle.setAttribute('aria-expanded', 'false');
                            const otherSubmenu = toggle.parentElement.querySelector('.dropdown-menu');
                            if (otherSubmenu) {
                                otherSubmenu.classList.remove('submenu-open');
                            }
                        }
                    });

                    // Wenn das geklickte Menü nicht offen war, öffne es. Sonst schliesse es.
                    if (!wasOpen) {
                        this.classList.add('active');
                        submenu.classList.add('submenu-open');
                        this.setAttribute('aria-expanded', 'true');
                    } else {
                        this.classList.remove('active');
                        submenu.classList.remove('submenu-open');
                        this.setAttribute('aria-expanded', 'false');
                    }
                });
            });

            // NEU: Bei Klick ausserhalb des Menüs schliessen (für Desktop-Ansicht)
            document.addEventListener('click', function (event) {
                // Prüft, ob der Klick ausserhalb des Navigations-Containers (.main-nav) stattgefunden hat
                const mainNav = document.querySelector('.main-nav');
                if (mainNav && !mainNav.contains(event.target)) {
                    // Finde alle offenen Submenüs und schliesse sie
                    document.querySelectorAll('.dropdown-menu.submenu-open').forEach(submenu => {
                        submenu.classList.remove('submenu-open');
                    });
                    // Entferne auch den 'active' Status vom Toggle-Button
                    document.querySelectorAll('.nav-item.dropdown > a.active').forEach(toggle => {
                        toggle.classList.remove('active');
                        toggle.setAttribute('aria-expanded', 'false');
                    });
                }
            });

            document.addEventListener('keydown', (event) => {
                if (event.key === 'Escape') {
                    const openSubmenu = navList.querySelector('.dropdown-menu.submenu-open');
                    if (openSubmenu) {
                        const associatedToggle = openSubmenu.parentElement.querySelector('a[aria-haspopup="true"]');

                        // Alle Menüs schließen
                        dropdownToggles.forEach(toggle => {
                            toggle.classList.remove('active');
                            toggle.setAttribute('aria-expanded', 'false');
                            const otherSubmenu = toggle.parentElement.querySelector('.dropdown-menu');
                            if (otherSubmenu) {
                                otherSubmenu.classList.remove('submenu-open');
                            }
                        });

                        // Fokus zurück auf den Button setzen, der das Menü geöffnet hat
                        if (associatedToggle) {
                            associatedToggle.focus();
                        }
                    }
                }
            });

            // 3. Smooth Scroll & Close Mobile Nav
            document.querySelectorAll('a[href]').forEach(anchor => {
                anchor.addEventListener('click', function (e) {
                    const href = this.getAttribute('href');
                    const isMobileView = navToggle && window.getComputedStyle(navToggle).display !== 'none';
                    let isMobileDropdownToggleItself = false;

                    if (isMobileView && this.parentElement && this.parentElement.classList.contains('dropdown') && this.closest('.nav-list') && this.querySelector('.dropdown-arrow')) {
                        const submenu = this.parentElement.querySelector('.dropdown-menu');
                        if (submenu) {
                            isMobileDropdownToggleItself = true;
                        }
                    }

                    if (href.startsWith('#') && href.length > 1) {
                        const targetElement = document.querySelector(href);
                        if (targetElement) {
                            e.preventDefault();
                            let headerOffset = siteHeader ? siteHeader.offsetHeight : 0;
                            const elementPosition = targetElement.getBoundingClientRect().top;
                            const offsetPosition = elementPosition + window.pageYOffset - headerOffset;
                            window.scrollTo({ top: offsetPosition, behavior: 'smooth' });
                        }
                    } else if (href === '#') {
                        e.preventDefault();
                        window.scrollTo({ top: 0, behavior: 'smooth' });
                    }

                    if (isMobileView && navList && navList.classList.contains('open') && !isMobileDropdownToggleItself) {
                        if (!href.startsWith('#') || (href.startsWith('#') && document.querySelector(href))) {
                            navList.classList.remove('open');
                            if (navToggle) {
                                navToggle.setAttribute('aria-expanded', 'false');
                                navToggle.innerHTML = '☰';
                            }
                            navList.querySelectorAll('.dropdown-menu.submenu-open').forEach(submenu => submenu.classList.remove('submenu-open'));
                            navList.querySelectorAll('.nav-item.dropdown > a.active, .nav-item.dropdown > span.active').forEach(toggle => toggle.classList.remove('active'));
                        }
                    }
                });
            });

            // Hero-Slideshow
            const slides = document.querySelectorAll('.hero-slideshow .hero-img');
            if (slides.length > 1) {
                let currentHeroSlide = 0;
                if (slides[currentHeroSlide]) slides[currentHeroSlide].classList.add('active');
                setInterval(() => {
                    if (slides[currentHeroSlide]) slides[currentHeroSlide].classList.remove('active');
                    currentHeroSlide = (currentHeroSlide + 1) % slides.length;
                    if (slides[currentHeroSlide]) slides[currentHeroSlide].classList.add('active');
                }, 5000);
            } else if (slides.length === 1 && slides[0]) {
                slides[0].classList.add('active');
            }

            // News Slider
            const newsSlider = document.querySelector('#news .news-slider');
            const newsItems = newsSlider ? newsSlider.querySelectorAll('.news-item') : [];
            const newsDotsContainer = document.querySelector('#news .news-dots');
            let currentNewsIndex = 0;
            let newsInterval;

            if (newsItems.length > 0 && newsDotsContainer) {
                newsItems.forEach((item, index) => {
                    const dot = document.createElement('span');
                    dot.classList.add('news-dot');
                    dot.dataset.index = index;
                    if (index === 0) dot.classList.add('active');
                    newsDotsContainer.appendChild(dot);
                });

                const newsDots = newsDotsContainer.querySelectorAll('.news-dot');

                function showNewsItem(index) {
                    newsItems.forEach(item => item.classList.remove('active'));
                    if (newsItems[index]) newsItems[index].classList.add('active');
                    newsDots.forEach(dot => dot.classList.remove('active'));
                    if (newsDots[index]) newsDots[index].classList.add('active');
                    currentNewsIndex = index;
                }

                function nextNewsItem() {
                    let nextIndex = (currentNewsIndex + 1) % newsItems.length;
                    showNewsItem(nextIndex);
                }

                newsDots.forEach(dot => {
                    dot.addEventListener('click', () => {
                        showNewsItem(parseInt(dot.dataset.index));
                        clearInterval(newsInterval);
                        newsInterval = setInterval(nextNewsItem, 7000);
                    });
                });

                showNewsItem(0);
                newsInterval = setInterval(nextNewsItem, 7000);
            }

            // Update current year in footer
            const yearSpan = document.getElementById('current-year');
            if (yearSpan) {
                yearSpan.textContent = new Date().getFullYear();
            }

            // IntersectionObserver für die "Über uns"-Sektion
            const aboutSection = document.getElementById('about');
            const aboutContentToReveal = aboutSection ? aboutSection.querySelector('.about-reveal-content') : null;
            if (aboutSection && aboutContentToReveal) {
                const revealAboutContent = (entries, observer) => {
                    entries.forEach(entry => {
                        if (entry.isIntersecting) {
                            aboutContentToReveal.classList.add('is-visible');
                            observer.unobserve(entry.target);
                        }
                    });
                };
                const aboutObserverOptions = { root: null, rootMargin: '0px', threshold: 0.1 };
                const aboutObserver = new IntersectionObserver(revealAboutContent, aboutObserverOptions);
                aboutObserver.observe(aboutSection);
            }

            // Click handler for service cards
            const serviceCards = document.querySelectorAll('.service-card');
            serviceCards.forEach(card => {
                const linkElement = card.querySelector('a.service-link-wrapper');
                if (linkElement) {
                    card.style.cursor = 'pointer';
                    card.addEventListener('click', () => {
                        window.location.href = linkElement.href;
                    });
                }
            });

            // Lightbox Funktionalität für das Teamfoto
            const teamPhotoContainer = document.getElementById('team-photo-container');
            const lightbox = document.getElementById('lightbox');
            const lightboxImage = document.getElementById('lightbox-image');
            const closeLightboxBtn = document.querySelector('.close-lightbox');

            if (teamPhotoContainer && lightbox && lightboxImage && closeLightboxBtn) {
                teamPhotoContainer.addEventListener('click', () => {
                    const originalImage = teamPhotoContainer.querySelector('img');
                    if (originalImage) {
                        lightboxImage.src = originalImage.src;
                        lightbox.classList.add('visible');
                    }
                });

                const closeLightbox = () => {
                    lightbox.classList.remove('visible');
                };

                closeLightboxBtn.addEventListener('click', closeLightbox);

                lightbox.addEventListener('click', (e) => {
                    if (e.target === lightbox) {
                        closeLightbox();
                    }
                });
                document.addEventListener('keydown', (e) => {
                    // Prüft, ob die gedrückte Taste "Escape" ist UND die Lightbox sichtbar ist
                    if (e.key === 'Escape' && lightbox.classList.contains('visible')) {
                        closeLightbox();
                    }
                });
            }
        });

        // Google Maps 2-Klick-Lösung
        const loadMapBtn = document.getElementById('load-map-btn');
        if (loadMapBtn) {
            loadMapBtn.addEventListener('click', function (e) {
                e.preventDefault();

                const iframe = document.getElementById('google-map-iframe');
                const placeholder = document.getElementById('map-placeholder');

                // 1. Die echte URL aus data-src in src kopieren
                iframe.src = iframe.getAttribute('data-src');

                // 2. Iframe sichtbar machen
                iframe.style.display = 'block';

                // 3. Platzhalter ausblenden
                placeholder.style.display = 'none';
            });
        }
    </script>

    {% block scripts %}{% endblock %}

</body>

</html>